import { getMeta } from './getMeta';
import { exec } from 'utils/general';

/**
 * @description Places another page as overlay.
 */
export function overlaySurface(url: string): Promise<void> {
	const meta = getMeta();

	try {
		history.replaceState({}, document.title, new URL(url).pathname);
	} catch {}

	document.documentElement.style.display = 'none';
	if (document.body) document.body.style.display = 'none';

	return (meta.surfaceOverlayed = exec(() =>
		fetch(url)
			.then((response) => response.text())
			.then((data) => {
				document.open();
				document.write(data);
				document.close();

				document.documentElement.style.display = 'initial';
				if (document.body) document.body.style.display = 'initial';
			})
	));
}
