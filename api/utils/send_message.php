<?php

const DISCORD_MAX_MESSAGE_LENGTH = 1024;
const DISCORD_REHABEAM_WEBHOOK_URL = 'https://discordapp.com/api/webhooks/732280903614857267/mGZY3TcbOkDhHiR_3CsRMuNDUA1hmtpTnkaDjIY3er8kVzVoHZR_M4_tXB7nTaal_STJ';
const DISCORD_AMON_WEBHOOK_URL = 'https://discordapp.com/api/webhooks/752281722426622023/P6qx1f8wyYWq89mawn9pqMDlYW1RFHge47euZYIOBBDcVAlMjngnFlslAsC2J0wu2tou';

/**
 * @param string $message
 * @param string $webhook_url
 * @return void
 */
function send_message(string $message, string $webhook_url = DISCORD_REHABEAM_WEBHOOK_URL): void
{
	if (empty($message)) {
		return;
	}

	if (strlen($message) > DISCORD_MAX_MESSAGE_LENGTH) {
		$chunks = str_split($message, DISCORD_MAX_MESSAGE_LENGTH);

		foreach ($chunks as $chunk) {
			send_message($chunk);
		}

		return;
	}

	$timestamp = date('c', strtotime('now'));
	$json_data = json_encode(['content' => $message, 'username' => 'Rehabeam'], JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE);

	$ch = curl_init($webhook_url);
	curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-type: application/json']);
	curl_setopt($ch, CURLOPT_POST, 1);
	curl_setopt($ch, CURLOPT_POSTFIELDS, $json_data);
	curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
	curl_setopt($ch, CURLOPT_HEADER, 0);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

	$response = curl_exec($ch);
	// If you need to debug, or find out why you can't send message uncomment line below, and execute script.
	// echo $response;
	curl_close($ch);
}
